
- hosts: ceph01
  any_errors_fatal: true
  tasks:
    - name: Add cluster
      shell: "ceph-deploy new {{ item }}"
      with_items: "{{ host }}"
    - name: Copy config
      template:
          src: templates/ceph.conf.j2
          dest: files/temp.conf
    - name: Apply ceph.conf
      shell: "cat files/temp.conf >> /etc/ceph/ceph.conf"

    - name: Install release
      shell: "ceph-deploy install --release nautilus {{ item }}"
      with_items: "{{ host }}"
      
    - name: Start monitor
      shell: "ceph-deploy mon create-initial"
      
    - name: Copy ceph.conf
      shelld: "ceph-deploy admin {{ item }}"
      with_items: "{{ host }}"

- hosts: all
  any_errors_fatal: true
  tasks:
    - name: Chmod
      shell: "sudo chmod +r /etc/ceph/ceph.client.admin.keyring"

- hosts: ceph01
  any_errors_fatal: true
  tasks:
    - name: Deploy manager
      shell: "ceph-deploy mgr create {{ item }}"
      with_items: "{{ host }}"

    - name: deploy osd
      shell: "ceph-deploy osd create --data {{ item[0] }} {{ item[1] }}"
      with_nested:
        - "{{ device }}"
        - "{{ host }}"
        
    - name: Status
      shell: "ceph -s"    


