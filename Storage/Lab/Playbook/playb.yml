- hosts:
  - mon
  - osd
  - mgr

  become: true
  tasks:
  - name: Install packet
    yum:
      name: '{{item}}'
      state: present
    with_items:
    - epel-release
    - wget
    - git
    - python-setuptools
    - python-virtualenv

- hosts: mon
  become: True
  any_errors_fatal: true
  tasks:
    - name: Deploy monitor
      command: "ceph-deploy new {{item}}"
      with_items: "{{ host }}"
    - name: Copy config
      template:
          src: templates/ceph.conf.j2
          dest: files/temp.conf
    - name: Apply ceph.conf
      shell: "cat files/temp.conf >> /etc/ceph/ceph.conf"
          

- hosts: mgr
  become: True
  any_errors_fatal: true
  command: "ceph-deploy mgr create {{item}}"
  with_items: "{{ host }}"
  with_items: hosts
#  roles:
#      - ceph-mgr

- hosts: osd
  become: True
  any_errors_fatal: true
  command: "ceph-deploy osd create --data {{item}}"
  with_items: "{{ device }}"
#  roles:
#      - ceph-osd


