
- hosts: ceph01
  any_errors_fatal: true
  tasks:
    - name: Add cluster
      command: "ceph-deploy new {{ item }}"
      with_items: "{{ host }}"
    - name: Copy config
      template:
          src: templates/ceph.conf.j2
          dest: files/temp.conf
    - name: Apply ceph.conf
      shell: "cat files/temp.conf >> /etc/ceph/ceph.conf"

    - name: Install release
      command: "ceph-deploy install --release nautilus {{ item }}"
      with_items: "{{ host }}"
      
    - name: Deploy manager
      command: "ceph-deploy mgr create {{ item }}"
      with_items: "{{ host }}"

    - name: deploy osd
      shell: "ceph-deploy osd create --data {{ item[0] }} {{ item[1] }}"
      with_nested:
        - "{{ device }}"
        - "{{ host }}"


